\chapter{Final thoughts}

\section{Discussion}

\subsection{RQ1}
Making the source code reusable for further development was an important, and modifiability was therefore one of the main focuses when designing the software architecture. Event-driven architecture was used to to achieve loose coupling between the different components. This gives us the option to replace the Wii remote with other types of sensors without major changes to the rest of the code. A handler class for the Wii remote was added to make it easier to implement support for multiple Wii remotes at a later date. This class also helps separate the Wii remote components from the rest of the system.processing sensory data in fall detection and prevention applications.

\subsection{RQ2}
Initially two different game controllers were considered as possible sensors; these controllers were the Playstation Move and Wii remote respectively. The PS Move Controller was the superior in respect to the sensors, with built in magnetometer and gyroscope. However, it soon became apparent that this controller was not a viable option. This was due to the lack of documentation on the reverse engineering of this controller, as well as the fact that there only exists one API. The reverse engineering of the Wii remote on the other hand is well documented through multiple communities and a multitude of APIs in different languages. The focus of the project therefore shifted toward supporting the Wii Remote.

There were several Wii remote libraries written in Java, where Motej was considered the most complete. There was some concern about the fact that all of these Java based libraries were at least three years old, including Motej. Though Motej was helpful as base for the overall structure as well as a good learning tool for understanding the reverse engineering of the Wii remote, during the development phase it became apparent how outdated the library actually was. This is why we eventually decided to write our own lightweight library called Motea. One of the reasons for choosing the Wii remote was the many Java libraries that existed. The amount of work put into modifying Motej and creating Motea was much greater than expected. In retrospect, the Playstation Move might have been a viable option.

\subsection{RQ3}
The prototype developed in this project as well as other applications CITATIONNEEDED have shown that modern smartphones are more than powerful enough to function as a hub for processing sensory data in fall detection and prevention applications. In our project we wanted to explore the possibility of using cheap, off-the-shelf motion based game controllers as the external sensors for the system. 

Madgwickâ€™s AHRS algorithm was used to calculate the orientation of the Wii remote. The algorithm is run on every sensor event, approximately ten times per second. Modern smartphones have no problem doing these calculations in real-time, while also rendering the 3D-cube. 

The limitations of the system is the lack of support for reflection used to access the L2CAP Bluetooth protocol which is required by the Wii remote. Initial research led us to believe that HTC and Samsung devices running stock ROMs would not support accessing L2CAP through reflection, and thus leave the application unable to connect to the Wii remote. To our surprise the application work fine on the HTC One S during the testing phase. HTC phones running version 4 of the Android OS might therefore be supported, though this has not been investigated further. Having an application that works out of the box on a major smartphone brand is an important for the viability of such an application.

\subsection{RQ4}
The viability tests were primarily positive and exceeded the minimum parameters we had set for our system. The Battery life was a positive surprise, the life expectancy was beyond our minimum 24 hours and the ``up to 30 hours stated by Nintendo. Seeing as constant rumble provided 33 hours and no rumble at all gave around 62 it is safe to expect that our application will be above 40 hours as users of the application will ideally make the vibration stop as soon as they can sense it. 

The Wii remote was connected to the smartphone using the robust and well proven Bluetooth technology for continuous streaming of sensory data. The Class 2 Bluetooth radio used in smartphones and motion controllers gives a theoretical range of 10 meters. Our tests indicates that the actual range is even greater than this. A range of more than 10 meters should be more than satisfactory considering the use of the application.

The feedback test showed that detecting the vibration might be a problem. The vibration provided by the Wii Remote was barely noticeable through the belt used for attachment to the user. This might be due to the heavy battery absorbing the vibration or the rumble engine simply not being powerful enough. It was necessary to press the Wii Remote firmly against the body before the vibration could be clearly felt. The audio feedback worked as intended and was easy to interpret. The implementation of the sound alarm needs further work and testing to assure that it work smoothly on all versions of the Android OS.

\subsection{Threats to validity}
One possible threat to validity is the software architectures focus on modifiability. As a proof-of-concept prototype system, prone to constant changes in hardware and functionality, a highly modifiable architecture is essential. For a system with specifed hardware and functionality modifiability would not be as crucial. In such a system availability and performance would be more important. For a fall detection/prevention application to be used in practice both high availability and performance would have to be guaranteed for obvious reasons. The architectural choices presented in this paper is therfore to be seen from a prototyping point of view, and not a system for production.

The viability tests did posses a large sample size or were performed in a highly controlled environment. The small sample size prevents us from strengthening our conclusions with statistical data or generalize our findings. Therefore the conclusions we come to in this paper are limited to our implementation or a similar mobile biofeedback system. If our system is viable or not is based on knowledge gained through research and working on the paper. However this is not close to the knowledge possessed by experts in the field, and review by such an individual might come to a different conclusion.


\section{Conclusion}

\textit{What architectural decision should be considered in a mobile biofeedback system?}


We created a software architecture with focus on modifiability and usability. Modifiability was important to ensure that different components, e.g. sensor choice, could be replaced or modified without effecting the system as a whole. With all the uncertainties surrounding sensor choice and functionality being able to change different components quickly is paramount. Though little effort was put into the graphical user interface in this project, usability was important for the prototype code to be reused in future work. The Model-View-Controller pattern was used to separate the GUI components, this in combination with the many features offered by the Android OS, creating a GUI at a later date should not be challenging.

\textit{Which game controllers are viable options in the creation of a mobile biofeedback system?}


There was no proper documentation on reverse engineering or Java based libraries for the PS Move Controller. The Wii Remote reverse engineering had been well documented by the community and several Java based libraries existed. Eventually it was discovered that all of the libraries were simply too old and inefficient to be of real use, and therefore we have created our own light-weight library under the name Motea.

\textit{What are the limitations of using the Android OS and game controllers in the creation of a biofeedback system?}


Older smartphones running stock firmware from major Android brands such as HTC and Samsung cannot run the application due to the lack of support for Bluetooth L2CAP protocol. It was discovered that an HTC smartphone running version 4.0 of the stock firmware was able to run the application however. This probably means that newer HTC phones can run the application out of the box, though this was not tested further.


\textit{What are important factors that will determine if the system has any viability as a mobile bio-feedback system, and what are acceptable parameters for these factors?}


We concluded that the most important factors for an initial prototype was battery life, range, performance, and investigating if the audio and vibration feedback is good enough. The three factors were all beyond satisfactory with a battery life of 60 hours, a range of 30 meters and a smooth performance proved that the prototype is viable. The vibration feedback was not satisfactory and was perceived as too weak to be noticeable, but the audio worked well.

\section{Further work}
This project have shown that Android smartphones with the correct software can connect and receive sensor data form Wii remotes. Our viability testing have shown that both battery life and range is satisfactory. Still, there is a lot of work to be done to create a functioning fall detection/prevention system using Android smartphones and Wii Remotes. First, the application needs to provide helpful feedback reducing the risk of falls, and alerting about falls. Second, the architecture needs to be tested in respect to availability and performance. Third, a user friendly user interface has to be created in order to allow older people, often unexperienced with modern technology, to use the application efficiently and safely. Fourth, an experiment has to be conducted to evaluate the effectiveness of the system and establish the best number of sensors and their optimal position.
\begin{comment}
+ Only an initial prototype
+ Optimization
+ Create proper algorithms for the threshold, and tweak sensor values
+ A more user friendly interface
+ Experiment with multiple controllers or different sensors ?
\end{comment}