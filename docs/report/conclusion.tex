\chapter{Final thoughts}

\section{Discussion}
The prototype developed in this project as well as other applications CITATIONNEEDED have show that modern smartphones are more than powerful enough to function as a hub for processing sensory data in fall detection and prevention applications. In our project we wanted to explore the possibility of using cheap, off-the-shelf motion based game controllers as the external sensors for the system. These sensors were then connected to the smartphone using the robust and well proven Bluetooth technology for continuous streaming of sensory data. The Class 2 Bluetooth radio used in smartphones and motion controllers gives a theoretical range of 10 meters. Our tests indicates that the actual range is even greater than this. A range of 10+ meters should be more than satisfactory considering the use of the application.

Initially two different game controllers were considered as possible sensors; these controllers were the Playstation Move and Wii remote respectively. The PS Move Controller was the superior in respect to the sensors, with built in magnetometer and gyroscope. However, it soon became apparent that this controller was not a viable option. This was due to the lack of documentation on the reverse engineering of this controller, as well as the fact that there only exists one API. The reverse engineering of the Wii remote on the other hand is well documented through multiple communities and a multitude of APIs in different languages. The focus of the project therefore shifted toward supporting the Wii Remote.

There were several Wii remote libraries written in Java, where Motej was considered the most complete. There was some concern about the fact that all of these Java based libraries were at least three years old, including Motej. Though Motej was helpful as base for the overall structure as well as a good learning tool for understanding the reverse engineering of the Wii remote, during the development phase it became apparent how outdated the library actually was. This is why we eventually decided to write our own lightweight library called Motea. One of the reasons for choosing the Wii remote was the many Java libraries that existed. The amount of work put into modifying Motej and creating Motea was much greater than expected. In retrospect, the Playstation Move might have been a viable option.

Making the source code reusable for further development was an important, and modifiability was therefore one of the main focuses when designing the software architecture. Event-driven architecture was used to to achieve loose coupling between the different components. This gives us the option to replace the Wii remote with other types of sensors without major changes to the rest of the code. A handler class for the Wii remote was added to make it easier to implement support for multiple Wii remotes at a later date. This class also helps separate the Wii remote components from the rest of the system.

Madgwick’s AHRS algorithm was used to calculate the orientation of the Wii remote. The algorithm is run on every sensor event, approximately ten times per second. Modern smartphones have no problem doing these calculations in real-time, while also rendering the 3D-cube. 

The viability tests were primarily positive and exceeded the minimum parameters we had set for our system. The Battery life was a positive surprise, the life expectancy was beyond our minimum 24 hours and the “up to 30 hours” stated by Nintendo. Seeing as constant rumble provided 33 hours and no rumble at all gave around 62 it is safe to expect that our application will be above 40 hours as users of the application will ideally make the vibration stop as soon as they can sense it. 

The feedback test showed that detecting the vibration might be a problem. The vibration provided by the Wii Remote was barely noticeable through the belt used for attachment to the user. This might be due to the heavy battery absorbing the vibration or the rumble engine simply not being powerful enough. It was necessary to press the Wii Remote firmly against the body before the vibration could be clearly felt. The audio feedback worked as intended and was easy to interpret. The implementation of the sound alarm needs further work and testing to assure that it work smoothly on all versions of the Android OS.

The limitations of the system is the lack of support for reflection used to access the L2CAP Bluetooth protocol which is required by the Wii remote. Initial research led us to believe that HTC and Samsung devices running stock ROMs would not support accessing L2CAP through reflection, and thus leave the application unable to connect to the Wii remote. To our surprise the application work fine on the HTC One S during the testing phase. HTC phones running version 4 of the Android OS might therefore be supported, though this has not been investigated further. Having an application that works out of the box on a major smartphone brand is an important for the viability of such an application.

SKRIV OM AT MAN MÅ BRUKE STANDARDBATTERIER

\section{Conclusion}

\textit{What architectural decision should be considered in a mobile bio-feedback system?}


We created a software architecture with focus on modifiability and usability. Modifiability was important to ensure that different components, e.g. sensor choice, could be replaced or modified without effecting the system as a whole. With all the uncertainties surrounding sensor choice and functionality being able to change different components quickly is paramount. Though little effort was put into the graphical user interface in this project, usability was important for the prototype code to be reused in future work. The Model-View-Controller pattern was used to separate the GUI components, this in combination with the many features offered by the Android OS, creating a GUI at a later date should not be challenging.

\textit{Which game controllers are viable options in the creation of a mobile bio-feedback system?}
There was no proper documentation on reverse engineering or Java based libraries for the PS Move Controller. The Wii Remote reverse engineering had been well documented by the community and several Java based libraries existed. Eventually it was discovered that all of the libraries were simply too old and inefficient to be of real use, and therefore we have created our own light-weight library under the name Motea.

\textit{What are the limitations of using the Android OS and game controllers in the creation of a bio-feedback system?}

\textit{What are important factors that will determine if the system has any viability as a mobile bio-feedback system, and what are acceptable parameters for these factors?}
We concluded that the most important factors for an initial prototype was battery life, range, performance, and investigating if the audio and vibration feedback is good enough. The three factors were all beyond satisfactory with a battery life of 60 hours, a range of 30 meters and a smooth performance proved that the prototype is viable. The vibration feedback was not satisfactory and was perceived as too weak to be noticeable, but the audio worked well.

overall conclusion?

\section{Further work}
+ Only an initial prototype
+ Optimization
+ Create proper algorithms for the threshold, and tweak sensor values
+ A more user friendly interface
